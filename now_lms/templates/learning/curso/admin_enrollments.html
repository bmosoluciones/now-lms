{% set current_theme = current_theme() %} {% set config = config() %} {% set permitir_docente =
docente_asignado(id_curso=curso.codigo) %} {% set permitir_moderador = moderador_asignado(id_curso=curso.codigo) %} {% set
permitir_editar = current_user.tipo == "admin" or permitir_docente %}

<!doctype html>
<html lang="{{ current_locale() }}" class="h-100">
    <head>
        {{ current_theme.headertags() }}
        <title>{{ _('Inscripciones') }} - {{ curso.nombre }}</title>
        {{ current_theme.local_style() }}
    </head>

    <body>
        {{ current_theme.navbar() }}

        <main>
            {{ current_theme.notify() }}
            <br />

            <div class="container mt-4">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <h4><i class="fas fa-users"></i> {{ _('Inscripciones del Curso') }}</h4>
                                    <p class="mb-0 text-muted">{{ curso.nombre }} ({{ curso.codigo }})</p>
                                </div>
                                <div>
                                    <a
                                        href="{{ url_for('course.admin_course_enrollment', course_code=curso.codigo) }}"
                                        class="btn btn-primary"
                                    >
                                        <i class="fas fa-user-plus"></i> {{ _('Inscribir Estudiante') }}
                                    </a>
                                    <a
                                        href="{{ url_for('course.administrar_curso', course_code=curso.codigo) }}"
                                        class="btn btn-secondary"
                                    >
                                        <i class="fas fa-arrow-left"></i> {{ _('Volver al Curso') }}
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                {% if enrollments %}
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>{{ _('Estudiante') }}</th>
                                                <th>{{ _('Email') }}</th>
                                                <th>{{ _('Fecha de Inscripción') }}</th>
                                                <th>{{ _('Método de Pago') }}</th>
                                                <th>{{ _('Estado del Pago') }}</th>
                                                <th>{{ _('Monto') }}</th>
                                                <th>{{ _('Inscrito Por') }}</th>
                                                <th>{{ _('Acciones') }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for enrollment, usuario, pago in enrollments %}
                                            <tr>
                                                <td>
                                                    <div>
                                                        <strong>{{ usuario.nombre }} {{ usuario.apellido }}</strong><br />
                                                        <small class="text-muted">{{ usuario.usuario }}</small>
                                                    </div>
                                                </td>
                                                <td>{{ usuario.correo_electronico }}</td>
                                                <td>
                                                    {{ enrollment.creado.strftime('%d/%m/%Y') if enrollment.creado else 'N/A'
                                                    }}
                                                </td>
                                                <td>
                                                    {% if pago %}
                                                    <span
                                                        class="badge bg-{% if pago.metodo == 'admin_enrollment' or pago.metodo == 'admin_program_enrollment' %}info{% elif pago.metodo == 'free' %}success{% elif pago.metodo == 'audit' %}warning{% else %}primary{% endif %}"
                                                    >
                                                        {% if pago.metodo == 'admin_enrollment' %} {{ _('Admin. Manual') }} {%
                                                        elif pago.metodo == 'admin_program_enrollment' %} {{ _('Admin.
                                                        Programa') }} {% elif pago.metodo == 'free' %} {{ _('Gratuito') }} {%
                                                        elif pago.metodo == 'audit' %} {{ _('Auditoría') }} {% else %} {{
                                                        pago.metodo.title() }} {% endif %}
                                                    </span>
                                                    {% else %}
                                                    <span class="badge bg-secondary">{{ _('Sin pago') }}</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if pago %}
                                                    <span
                                                        class="badge bg-{% if pago.estado == 'completed' %}success{% elif pago.estado == 'pending' %}warning{% else %}danger{% endif %}"
                                                    >
                                                        {{ pago.estado.title() }}
                                                    </span>
                                                    {% else %}
                                                    <span class="badge bg-secondary">N/A</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if pago and pago.monto %} {{ pago.monto }} {{ pago.moneda or 'USD' }} {%
                                                    else %}
                                                    <span class="text-muted">$0</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <small class="text-muted"
                                                        >{{ enrollment.creado_por or _('Sistema') }}</small
                                                    >
                                                </td>
                                                <td>
                                                    <form
                                                        method="POST"
                                                        action="{{ url_for('course.admin_course_unenrollment', course_code=curso.codigo, student_username=usuario.usuario) }}"
                                                        style="display: inline"
                                                        onsubmit="return confirm('{{ _('¿Estás seguro de que deseas desinscribir a') }} {{ usuario.nombre }} {{ usuario.apellido }}?');"
                                                    >
                                                        <button
                                                            type="submit"
                                                            class="btn btn-sm btn-outline-danger"
                                                            title="{{ _('Desinscribir') }}"
                                                        >
                                                            <i class="fas fa-user-times"></i>
                                                        </button>
                                                    </form>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="text-center py-5">
                                    <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">{{ _('No hay estudiantes inscritos') }}</h5>
                                    <p class="text-muted">{{ _('Aún no hay estudiantes inscritos en este curso.') }}</p>
                                    <a
                                        href="{{ url_for('course.admin_course_enrollment', course_code=curso.codigo) }}"
                                        class="btn btn-primary"
                                    >
                                        <i class="fas fa-user-plus"></i> {{ _('Inscribir Primer Estudiante') }}
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </body>
</html>
